<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MeetMinder Settings</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }

        .settings-header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #667eea;
        }

        .settings-header h1 {
            font-size: 28px;
            color: #667eea;
            margin-bottom: 5px;
        }

        .settings-header p {
            color: #666;
            font-size: 14px;
        }

        .settings-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid #e0e0e0;
        }

        .setting-item {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .setting-item:hover {
            background: #f0f0f0;
        }

        .setting-label {
            display: block;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .setting-description {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 10px;
        }

        input[type="text"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #667eea;
        }

        .hotkey-input {
            display: inline-block;
            width: 200px;
            padding: 8px 12px;
            border: 2px solid #667eea;
            border-radius: 6px;
            background: white;
            font-weight: 600;
            color: #667eea;
            text-align: center;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: flex-end;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-cancel {
            background: #e0e0e0;
            color: #333;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
        }

        .btn-reset {
            background: #ff6b6b;
            color: white;
        }

        .btn-reset:hover {
            background: #ff5252;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 13px;
            color: #1976d2;
        }

        .success-message {
            background: #4caf50;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .model-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 10px;
        }

        .model-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .model-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .model-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .model-option .model-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .model-option .model-desc {
            font-size: 12px;
            opacity: 0.8;
        }

        /* Scrollbar styling */
        .settings-container::-webkit-scrollbar {
            width: 8px;
        }

        .settings-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .settings-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .settings-container::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <div class="settings-header">
            <h1>‚öôÔ∏è Settings</h1>
            <p>Configure your MeetMinder experience</p>
        </div>

        <div id="successMessage" class="success-message">
            Settings saved successfully!
        </div>

        <!-- AI Configuration -->
        <div class="settings-section">
            <div class="section-title">ü§ñ AI Configuration</div>
            
            <div class="setting-item">
                <label class="setting-label">AI Provider</label>
                <span class="setting-description">Choose your AI service provider</span>
                <select id="aiProvider">
                    <option value="azure_openai">Azure OpenAI</option>
                    <option value="openai">OpenAI</option>
                    <option value="google_gemini">Google Gemini</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label">API Key</label>
                <span class="setting-description">Your AI service API key (keep this secure)</span>
                <input type="text" id="apiKey" placeholder="sk-...">
            </div>

            <div class="setting-item">
                <label class="setting-label">Model</label>
                <span class="setting-description">Select the AI model to use</span>
                <input type="text" id="aiModel" placeholder="gpt-4">
            </div>

            <div class="setting-item">
                <label class="setting-label">Response Style</label>
                <select id="responseStyle">
                    <option value="concise">Concise</option>
                    <option value="detailed">Detailed</option>
                    <option value="balanced">Balanced</option>
                </select>
            </div>
        </div>

        <!-- Audio Settings -->
        <div class="settings-section">
            <div class="section-title">üé§ Audio Settings</div>
            
            <div class="setting-item">
                <label class="setting-label">Audio Mode</label>
                <select id="audioMode">
                    <option value="single_stream">Microphone Only</option>
                    <option value="dual_stream">Microphone + System Audio</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label">Sample Rate (Hz)</label>
                <select id="sampleRate">
                    <option value="22050">22050</option>
                    <option value="44100">44100</option>
                    <option value="48000">48000</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label">Whisper Language</label>
                <span class="setting-description">Language for speech recognition</span>
                <select id="whisperLanguage">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="zh">Chinese</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                    <option value="auto">Auto-detect</option>
                </select>
            </div>

            <div class="setting-item">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="autoTranscribe">
                    <label class="setting-label" for="autoTranscribe">Auto-start transcription on launch</label>
                </div>
            </div>
        </div>

        <!-- Hotkey Settings -->
        <div class="settings-section">
            <div class="section-title">‚å®Ô∏è Hotkeys</div>
            
            <div class="setting-item">
                <label class="setting-label">Trigger AI Assistance</label>
                <input type="text" id="hotkeyTrigger" class="hotkey-input" value="ctrl+space" readonly>
                <span class="setting-description">Click and press your desired key combination</span>
            </div>

            <div class="setting-item">
                <label class="setting-label">Toggle Overlay</label>
                <input type="text" id="hotkeyToggle" class="hotkey-input" value="ctrl+b" readonly>
            </div>

            <div class="setting-item">
                <label class="setting-label">Take Screenshot</label>
                <input type="text" id="hotkeyScreenshot" class="hotkey-input" value="ctrl+h" readonly>
            </div>
        </div>

        <!-- UI Settings -->
        <div class="settings-section">
            <div class="section-title">üé® Interface</div>
            
            <div class="setting-item">
                <label class="setting-label">Overlay Position</label>
                <select id="overlayPosition">
                    <option value="top-right">Top Right</option>
                    <option value="top-left">Top Left</option>
                    <option value="bottom-right">Bottom Right</option>
                    <option value="bottom-left">Bottom Left</option>
                    <option value="center">Center</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label">Overlay Opacity (%)</label>
                <input type="number" id="overlayOpacity" min="50" max="100" value="95">
            </div>

            <div class="setting-item">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="alwaysOnTop">
                    <label class="setting-label" for="alwaysOnTop">Keep overlay always on top</label>
                </div>
            </div>

            <div class="setting-item">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="startMinimized">
                    <label class="setting-label" for="startMinimized">Start minimized to system tray</label>
                </div>
            </div>
        </div>

        <!-- User Profile -->
        <div class="settings-section">
            <div class="section-title">üë§ User Profile</div>
            
            <div class="setting-item">
                <label class="setting-label">Your Name</label>
                <input type="text" id="userName" placeholder="Your name">
            </div>

            <div class="setting-item">
                <label class="setting-label">Your Title/Role</label>
                <input type="text" id="userTitle" placeholder="Software Engineer">
            </div>

            <div class="setting-item">
                <label class="setting-label">Skills (comma-separated)</label>
                <textarea id="userSkills" placeholder="Python, JavaScript, Machine Learning"></textarea>
            </div>
        </div>

        <!-- Advanced Settings -->
        <div class="settings-section">
            <div class="section-title">‚ö° Advanced</div>
            
            <div class="setting-item">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableCache">
                    <label class="setting-label" for="enableCache">Enable AI response caching</label>
                </div>
                <span class="setting-description">Cache AI responses for faster repeated queries</span>
            </div>

            <div class="setting-item">
                <div class="checkbox-wrapper">
                    <input type="checkbox" id="enableLogging">
                    <label class="setting-label" for="enableLogging">Enable detailed logging</label>
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label">Max Conversation History</label>
                <input type="number" id="maxHistory" min="5" max="50" value="20">
            </div>
        </div>

        <div class="info-box">
            ‚ÑπÔ∏è <strong>Note:</strong> Some settings require application restart to take effect. 
            Your API keys are stored securely in the local configuration file.
        </div>

        <!-- Buttons -->
        <div class="button-group">
            <button class="btn-reset" onclick="resetSettings()">Reset to Defaults</button>
            <button class="btn-cancel" onclick="closeSettings()">Cancel</button>
            <button class="btn-save" onclick="saveSettings()">Save Changes</button>
        </div>
    </div>

    <script>
        // Load current settings
        function loadSettings() {
            pywebview.api.get_settings().then(settings => {
                if (settings) {
                    // AI Settings
                    if (settings.ai) {
                        document.getElementById('aiProvider').value = settings.ai.type || 'azure_openai';
                        document.getElementById('apiKey').value = settings.ai.api_key || '';
                        document.getElementById('aiModel').value = settings.ai.model || 'gpt-4';
                        document.getElementById('responseStyle').value = settings.ai.response_style || 'balanced';
                    }

                    // Audio Settings
                    if (settings.audio) {
                        document.getElementById('audioMode').value = settings.audio.mode || 'single_stream';
                        document.getElementById('sampleRate').value = settings.audio.sample_rate || '44100';
                        document.getElementById('whisperLanguage').value = settings.audio.language || 'en';
                        document.getElementById('autoTranscribe').checked = settings.audio.auto_start || false;
                    }

                    // Hotkeys
                    if (settings.hotkeys) {
                        document.getElementById('hotkeyTrigger').value = settings.hotkeys.trigger_assistance || 'ctrl+space';
                        document.getElementById('hotkeyToggle').value = settings.hotkeys.toggle_overlay || 'ctrl+b';
                        document.getElementById('hotkeyScreenshot').value = settings.hotkeys.take_screenshot || 'ctrl+h';
                    }

                    // UI Settings
                    if (settings.ui) {
                        document.getElementById('overlayPosition').value = settings.ui.position || 'top-right';
                        document.getElementById('overlayOpacity').value = settings.ui.opacity || 95;
                        document.getElementById('alwaysOnTop').checked = settings.ui.always_on_top || false;
                        document.getElementById('startMinimized').checked = settings.ui.start_minimized || false;
                    }

                    // User Profile
                    if (settings.user_profile) {
                        document.getElementById('userName').value = settings.user_profile.name || '';
                        document.getElementById('userTitle').value = settings.user_profile.title || '';
                        document.getElementById('userSkills').value = settings.user_profile.skills ? settings.user_profile.skills.join(', ') : '';
                    }

                    // Advanced
                    if (settings.advanced) {
                        document.getElementById('enableCache').checked = settings.advanced.enable_cache !== false;
                        document.getElementById('enableLogging').checked = settings.advanced.enable_logging || false;
                        document.getElementById('maxHistory').value = settings.advanced.max_history || 20;
                    }
                }
            }).catch(error => {
                console.error('Error loading settings:', error);
            });
        }

        // Save settings
        function saveSettings() {
            const settings = {
                ai: {
                    type: document.getElementById('aiProvider').value,
                    api_key: document.getElementById('apiKey').value,
                    model: document.getElementById('aiModel').value,
                    response_style: document.getElementById('responseStyle').value
                },
                audio: {
                    mode: document.getElementById('audioMode').value,
                    sample_rate: parseInt(document.getElementById('sampleRate').value),
                    language: document.getElementById('whisperLanguage').value,
                    auto_start: document.getElementById('autoTranscribe').checked
                },
                hotkeys: {
                    trigger_assistance: document.getElementById('hotkeyTrigger').value,
                    toggle_overlay: document.getElementById('hotkeyToggle').value,
                    take_screenshot: document.getElementById('hotkeyScreenshot').value
                },
                ui: {
                    position: document.getElementById('overlayPosition').value,
                    opacity: parseInt(document.getElementById('overlayOpacity').value),
                    always_on_top: document.getElementById('alwaysOnTop').checked,
                    start_minimized: document.getElementById('startMinimized').checked
                },
                user_profile: {
                    name: document.getElementById('userName').value,
                    title: document.getElementById('userTitle').value,
                    skills: document.getElementById('userSkills').value.split(',').map(s => s.trim()).filter(s => s)
                },
                advanced: {
                    enable_cache: document.getElementById('enableCache').checked,
                    enable_logging: document.getElementById('enableLogging').checked,
                    max_history: parseInt(document.getElementById('maxHistory').value)
                }
            };

            pywebview.api.save_settings(settings).then(result => {
                if (result.success) {
                    showSuccessMessage();
                    setTimeout(() => closeSettings(), 2000);
                }
            }).catch(error => {
                console.error('Error saving settings:', error);
                alert('Error saving settings: ' + error);
            });
        }

        // Reset to defaults
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                pywebview.api.reset_settings().then(() => {
                    loadSettings();
                    showSuccessMessage('Settings reset to defaults!');
                });
            }
        }

        // Close settings
        function closeSettings() {
            pywebview.api.close_settings();
        }

        // Show success message
        function showSuccessMessage(message = 'Settings saved successfully!') {
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = message;
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        // Hotkey capture
        document.querySelectorAll('.hotkey-input').forEach(input => {
            input.addEventListener('click', function() {
                this.value = 'Press keys...';
                this.style.background = '#fff3cd';
            });

            input.addEventListener('keydown', function(e) {
                e.preventDefault();
                const keys = [];
                if (e.ctrlKey) keys.push('ctrl');
                if (e.altKey) keys.push('alt');
                if (e.shiftKey) keys.push('shift');
                if (e.metaKey) keys.push('meta');
                
                const key = e.key.toLowerCase();
                if (!['control', 'alt', 'shift', 'meta'].includes(key)) {
                    keys.push(key);
                }
                
                this.value = keys.join('+');
                this.style.background = 'white';
            });
        });

        // Load settings on page load
        window.addEventListener('pywebviewready', function() {
            loadSettings();
        });

        // Fallback if pywebviewready doesn't fire
        setTimeout(loadSettings, 100);
    </script>
</body>
</html>



